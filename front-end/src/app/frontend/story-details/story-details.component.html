<!-- Single story page title -->
<div *ngIf="displayStoryError == true">
  We couldnâ€™t find this page.
</div>
<div *ngIf="dataLoading == true" style="min-height: 80vh;">
  <!-- Loading -->
  <content-loader>
  <svg:rect x="0" y="0" rx="3" ry="3" width="400" height="80" />
    <svg:rect x="0" y="90" rx="3" ry="3" width="250" height="2" />
      <svg:rect x="0" y="95" rx="3" ry="3" width="250" height="2" />
        <svg:rect x="4" y="100" rx="3" ry="3" width="220" height="2" />
          <svg:rect x="4" y="105" rx="3" ry="3" width="220" height="2" />
            <svg:rect x="4" y="110" rx="3" ry="3" width="170" height="2" />
              <svg:rect x="4" y="115" rx="3" ry="3" width="170" height="2" />
                <svg:rect x="4" y="120" rx="3" ry="3" width="250" height="2" />
                  <svg:rect x="4" y="125" rx="3" ry="3" width="250" height="2" />
                    <svg:rect x="4" y="130" rx="3" ry="3" width="200" height="2" />
                      <svg:rect x="4" y="135" rx="3" ry="3" width="200" height="2" />
                        <svg:rect x="0" y="140" rx="3" ry="3" width="80" height="2" />
                          <svg:rect x="0" y="145" rx="3" ry="3" width="80" height="2" />
                            <svg:rect x="0" y="150" rx="3" ry="3" width="250" height="2" />
                              </content-loader>
                            </div>
                            <div class="single_story_page_title text-left single_story_page_title_col" *ngIf="displayStory == true && dataLoading == false" [ngStyle]="{ 'background-image': 'url(' + storyData.preview_image + ')'}">
                              <div class="container" *ngIf="(storyData | json) != '{}'">
                                <div class="singleStory_head">
                                  <div class="row text-center">
                                    <div class="col-md-12">
                                      <div class="story_tag_wrap">
                                        <a href="#" [routerLink]="['/search']" [queryParams]="{type: storyData.type}"  class="dark_tag" *ngIf="storyData.type == 1">Workplace</a>
                                        <a href="#" [routerLink]="['/search']" [queryParams]="{type: storyData.type}"  class="dark_tag" *ngIf="storyData.type == 2">Business</a>
                                        <a *ngFor="let tag of storyData.tags" [routerLink]="['/search/']" [queryParams]="{tag: tag.tag_id}" class="light_tag">{{tag.name}}</a>
                                      </div>
                                      <h1>{{storyData.title}}</h1>
                                      <div class="right_inner_footer_bottom top20">
                                        <ul>
                                          <li *ngIf="isLoggedIn == 'true'" (click)="like()">
                                            <img src="assets/img/liked.png" alt="" *ngIf="storyData?.liked">
                                            <img src="assets/img/like_white.png" alt="" *ngIf="!storyData?.liked">
                                            Recommend
                                          </li>
                                          <li *ngIf="isLoggedIn != 'true'" (click)="showLoginPopup()">
                                            <img src="assets/img/like_white.png" alt="" *ngIf="!storyData?.liked">
                                            Recommend
                                          </li>
                                          <li *ngIf="isLoggedIn == 'true' && storyData?.flagged == false" data-toggle="modal" data-target="#confirm-report-modal">
                                            <span>
                                              <i class="fa fa-flag-o fa-2x"></i>
                                            </span>
                                            Report
                                          </li>
                                          <li *ngIf="isLoggedIn == 'true' && storyData?.flagged == true" data-toggle="modal" data-target="#already-reported">
                                            <span>
                                              <i class="fa fa-flag-o fa-2x" style="color:#f1663b;"></i>
                                            </span>
                                            Report
                                          </li>
                                          <li class="bookmark"><div class="share_img_wrap"><img src="assets/img/bookmark.png" alt="">
                                            <div class="social_wrap">
                                              <ul>
                                                <li>
                                                  <a [href]="'https://www.facebook.com/sharer/sharer.php?u='+storyData?.shareSlug" target="_blank">
                                                    
                                                    <img src="assets/img/facebook.png" [alt]="storyData?.preview_title">
                                                  </a>
                                                </li>
                                                <li>
                                                  <a [href]="'http://twitter.com/share?text='+storyData?.preview_title+'&url='+storyData?.shareSlug" target="_blank">
                                                    <img src="assets/img/twtr.png" [alt]="storyData?.preview_title">
                                                  </a>
                                                </li>
                                                <li>
                                                  <a [href]="'https://www.linkedin.com/shareArticle?mini=true&url='+storyData?.shareSlug+'&title='+storyData?.preview_title+'&source=LinkedIn'" target="_blank">
                                                    <img src="assets/img/linkedIn.png" [alt]="storyData?.preview_title">
                                                  </a>
                                                </li>
                                              </ul>
                                            </div>
                                          </div>
                                        </li>
                                        <!-- <li class="bookmark"><img src="assets/img/bookmark.png" alt=""> 14 min rea</li> -->
                                      </ul>
                                    </div>
                                  </div>
                                  <div class="story_post_date story_post_date_single">{{storyData.created | date: 'mediumDate'}}</div>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-md-12 single_profile_wrap">
                                  <div class="coFounder_top_img" [routerLink]="['/author/', storyData.username]">
                                    <img [src]="storyData.profile_pic" alt="">
                                  </div>
                                  <div class="coFounder_top_des">
                                    <h1 class="singleStory_title" [routerLink]="['/author/', storyData.username]">
                                    {{storyData.first_name}} {{storyData.last_name}}
                                    </h1>
                                    <!-- <h3 class="singleStory_Subtitle">{{storyData.professional_info}}</h3> -->
                                  </div>
                                </div>
                              </div>
                            </div>
                            <!-- <div class="container">
                              <div class="row">
                                <div class="col-md-12">
                                  <div class="story_tag_wrap">
                                    <a href="#" class="dark_tag">Russia</a>
                                    
                                    <a *ngFor="let tag of storyData.tags" [routerLink]="['/search/']" [queryParams]="{tag: tag.tag_id}" class="light_tag">{{tag.name}}</a>
                                    
                                  </div>
                                  <h1>{{storyData.title}}</h1>
                                  <div class="right_inner_footer_bottom top20">
                                    <ul>
                                      <li><a (click)="like()"><img src="assets/img/like_white.png" alt=""> FASCINATING</a></li>
                                      <li class="bookmark"><img src="assets/img/bookmark.png" alt=""> 14 min rea</li>
                                    </ul>
                                  </div>
                                </div>
                              </div>
                            </div> -->
                            <!-- <div class="story_post_date">{{storyData.created | date: 'mediumDate'}} </div> -->
                          </div>
                          <!-- Single story page title -->
                          <!-- Single story page section 2 -->
                          <div class="container-fluid single_page_tagline_wrap single_page_content" *ngIf="displayStory == true">
                            <div class="container">
                              <div class="row">
                                <div [innerHtml]="storyData.description | safeHtml"></div>
                              </div>
                            </div>
                          </div>
                          <div class="container" *ngIf="(storyData | json) != '{}'">
                            <div class="row">
                              <div class="col-md-12">
                                <div class="right_inner_footer_bottom top20 single_footer_social_share">
                                  <ul>
                                    <li *ngIf="isLoggedIn == 'true'" (click)="like()">
                                      <img src="assets/img/liked.png" alt="" *ngIf="storyData?.liked">
                                      <img src="assets/img/like-black.png" alt="" *ngIf="!storyData?.liked">
                                      Recommend
                                    </li>
                                    <li *ngIf="isLoggedIn != 'true'" (click)="showLoginPopup()">
                                      <img src="assets/img/like-black.png" alt="" *ngIf="!storyData?.liked">
                                      Recommend
                                    </li>
                                    <li *ngIf="isLoggedIn == 'true' && storyData?.flagged == false" data-toggle="modal" data-target="#confirm-report-modal">
                                      <span>
                                        <i class="fa fa-flag-o fa-2x"></i>
                                      </span>
                                      Report
                                    </li>
                                    <li *ngIf="isLoggedIn == 'true' && storyData?.flagged == true" data-toggle="modal" data-target="#already-reported">
                                      <span>
                                        <i class="fa fa-flag-o fa-2x" style="color:#f1663b;"></i>
                                      </span>
                                      Report
                                    </li>
                                    <li class="bookmark"><div class="share_img_wrap"><img src="assets/img/bookmark.png" alt="">
                                      <div class="social_wrap">
                                        <ul>
                                          <li>
                                            <a [href]="'https://www.facebook.com/sharer/sharer.php?u='+storyData?.shareSlug" target="_blank">
                                              
                                              <img src="assets/img/facebook.png" [alt]="storyData?.preview_title">
                                            </a>
                                          </li>
                                          <li>
                                            <a [href]="'http://twitter.com/share?text='+storyData?.preview_title+'&url='+storyData?.shareSlug" target="_blank">
                                              <img src="assets/img/twtr.png" [alt]="storyData?.preview_title">
                                            </a>
                                          </li>
                                          <li>
                                            <a [href]="'https://www.linkedin.com/shareArticle?mini=true&url='+storyData?.shareSlug+'&title='+storyData?.preview_title+'&source=LinkedIn'" target="_blank">
                                              <img src="assets/img/linkedIn.png" [alt]="storyData?.preview_title">
                                            </a>
                                          </li>
                                        </ul>
                                      </div>
                                    </div>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                        </div>
                        <!-- Comments section -->
                        <div class="container-fluid single_page_comments comment-wrapper" *ngIf="displayStory == true">
                          <div class="container">
                            <div class="comments_heading"><h3>Comments</h3></div>
                            <div class="row" *ngIf="comments?.length > 0; else noComments;">
                              <ul class="media-list col-md-12">
                                <ng-template #commentsList let-comments>
                                <li class="media" *ngFor="let comment of comments; let indx = index">
                                  <a href="#" class="pull-left pr-3" [routerLink]="['/author/', comment.username]">
                                    <img *ngIf="comment.profile_pic; else defaultImage" class="rounded-circle" src="{{comment.profile_pic}}">
                                    <ng-template #defaultImage>
                                    <!-- <img class="rounded-circle" src="assets/img/default-user-image.jpg"> -->
                                    <div class="user-imageholder">
                                      <span class="name-letter" [routerLink]="['/author/', comment.username]">
                                        {{(comment.first_name | slice:0:1)}}{{(comment.last_name | slice:0:1)}}
                                      </span>
                                    </div>
                                    </ng-template>
                                  </a>
                                  <div class="media-body">
                                    <span class="text-muted pull-right">
                                      <small class="text-muted">{{comment.created}}</small>
                                    </span>
                                    <strong class="theme_color" [routerLink]="['/author/', comment.username]">{{comment.first_name}} {{comment.last_name}}</strong>
                                    
                                    <p> {{comment.content}} </p>
                                    
                                    <p *ngIf="comment.approved == 0">
                                      <small class="text-muted">(Pending Approval)</small>
                                    </p>
                                    <ul *ngIf="comment.children?.length > 0">
                                      <ng-container *ngTemplateOutlet="commentsList; context:{ $implicit: comment.children }"></ng-container>
                                    </ul>
                                    
                                    <a class="alink" *ngIf="comment.parent == 0 && isLoggedIn == 'true'" (click)="comment.addReply = 'true'">Reply</a>
                                    <form [formGroup]="commentsForm" (ngSubmit)="addComment(comment.comment_id, indx)" *ngIf="comment.parent == 0 && comment.addReply == 'true'">
                                      <input type="hidden" formControlName="parent" value="comment.comment_id">
                                      <div class="form-group">
                                        <textarea class="form-control" formControlName="comment"></textarea>
                                      </div>
                                      <button class="theme_btn">Add Comment</button>
                                      <button class="theme_btn" (click)="comment.addReply = 'false'">Cancel</button>
                                    </form>
                                  </div>
                                </li>
                                </ng-template>
                                <ng-container *ngTemplateOutlet="commentsList; context:{ $implicit: comments }"></ng-container>
                              </ul>
                            </div>
                            <ng-template #noComments>
                            There are no comments yet, we are awaiting your opinion.
                            </ng-template>
                            <div class="row" *ngIf="isLoggedIn == 'true'; else showLogin">
                              <div class="col-md-4" *ngIf="showCommentBox == 'true'; else showCommentButton">
                                <form [formGroup]="commentsForm" (ngSubmit)="addComment()">
                                  <input type="hidden" formControlName="parent">
                                  <div class="form-group">
                                    <textarea class="form-control" formControlName="comment"></textarea>
                                  </div>
                                  <button class="theme_btn">Add</button>
                                  <button class="theme_btn" (click)="showCommentBox = 'false'">Cancel</button>
                                </form>
                              </div>
                              
                              <ng-template #showCommentButton>
                              <div class="col-md-4">
                                <button class="theme_btn" (click)="showCommentBox = 'true'">Add Comment</button>
                              </div>
                              </ng-template>
                              
                            </div>
                            <ng-template #showLogin>
                            <button class="login-message theme_btn" (click)="showLoginPopup()">Login to comment</button>
                            </ng-template>
                          </div>
                        </div>
                        <!-- The Modal -->
                        <div *ngIf="(storyData | json) != '{}'">
                          <div class="modal fade" id="confirm-report-modal" *ngIf="isLoggedIn == 'true' && storyData?.flagged == false">
                            <div class="modal-dialog">
                              <div class="modal-content">
                                
                                <!-- Modal Header -->
                                <div class="modal-header p-2">
                                  <h4 class="modal-title">Confirmation</h4>
                                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                
                                <!-- Modal body -->
                                <div class="modal-body pt-5 pb-5">
                                  <p>Click on confirm to flag this story as inappropriate.</p>
                                </div>
                                
                                <!-- Modal footer -->
                                <div class="modal-footer p-2">
                                  <button type="button" class="btn btn-sm btn-success" data-dismiss="modal" (click)="reportStory()">Confirm</button>
                                  <button type="button" class="btn btn-sm btn-danger" data-dismiss="modal">Close</button>
                                </div>
                                
                              </div>
                            </div>
                          </div>
                        </div>
                        <!-- The Modal -->
                        <div *ngIf="(storyData | json) != '{}'">
                          
                          <div class="modal fade" id="already-reported" *ngIf="isLoggedIn == 'true' && storyData?.flagged == true">
                            <div class="modal-dialog">
                              <div class="modal-content">
                                
                                <!-- Modal Header -->
                                <div class="modal-header p-2">
                                  <h4 class="modal-title">Already Reported</h4>
                                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                
                                <!-- Modal body -->
                                <div class="modal-body pt-5 pb-5">
                                  <p>You have already flagged this story as inappropriate.</p>
                                </div>
                                
                                <!-- Modal footer -->
                                <div class="modal-footer p-2">
                                  <button type="button" class="btn btn-sm btn-danger" data-dismiss="modal">Close</button>
                                </div>
                                
                              </div>
                            </div>
                          </div>
                        </div>